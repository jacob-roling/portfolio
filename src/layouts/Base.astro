---
import { Icon } from "astro-icon/components";
import "#/style/global.css";
import Search from "#components/Search.astro";

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<html lang="en" dir="ltr" class="dark">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <link rel="canonical" href={canonicalURL.href.slice(0, -1)} />
    <!-- htmx Extensions -->
    <script src="https://unpkg.com/idiomorph/dist/idiomorph-ext.min.js"
    ></script>
    <!-- RSS -->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Jacob Roling"
      href={`${Astro.site}rss.xml`}
    />
    <!-- Sitemap -->
    <link rel="sitemap" href="/sitemap-index.xml" />
    <!-- PageFind -->
    {import.meta.env.PROD ? <script src="/pagefind/pagefind-ui.js" /> : null}
    <!-- Partytown -->
    <script type="text/partytown">
      !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
      posthog.init('phc_j9j8JsVxiXDBu7g9lz1F6NYbuOvFSQspdWjXWzOOvbW',{api_host:'https://us.i.posthog.com'})
    </script>
    <!-- Custom -->
    <slot name="head" />
    <!-- Generated -->
  </head>
  <body hx-boost="true" hx-ext="morph, route-announcer" class="text-[1.125rem]">
    <header
      class="z-10 print:hidden fixed container w-full top-0 border-b bg-neutral-background-subtle"
    >
      <div class="breakout container bg-warning-background-element text-warning-text-high-contrast py-1">
        <p class="text-center"><span aria-hidden="true">ðŸš§</span> This website is currently under construction. <span aria-hidden="true">ðŸš§</span></p>
      </div>
      <nav aria-label="primary" class="py-2">
        <ul class="flex gap-4" role="list">
          <li class="sr-only focus-within:not-sr-only">
            <a class="button" href="#main">Skip to content</a>
          </li>
          <li>
            <a class="button" href="/">Home</a>
          </li>
          <li>
            <a class="button" href="/blog/page/1">Blog</a>
          </li>
          <li>
            <a class="button" href="/#projects">Projects</a>
          </li>
          <!-- <li>
            <label for="theme-switcher">Theme</label>
            <select name="theme-switcher" id="theme-switcher">
              <option value="auto">Auto</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </li> -->
          <li>
            <button class="button" onclick="print()">Print</button>
          </li>
          <li class="ml-auto">
            <button class="button outline" onclick="document.getElementById('search').showModal()">
              <Icon
                class="inline"
                name="heroicons:magnifying-glass"
                aria-hidden="true"
              />
              Search
              <span class="badge">
                <kbd>Ctrl</kbd> + <kbd>k</kbd>
              </span>
            </button>
          </li>
        </ul>
      </nav>
    </header>

    <slot />

    <footer
      class="mt-auto container typography print:hidden bg-neutral-background-subtle py-4 border-t"
    >
      <nav aria-label="footer">
        <ul class="flex gap-4 items-center max-w-full" role="list">
          <li>
            <a href="/sitemap-index.xml">Sitemap</a>
          </li>
          <li>
            <a href="/rss.xml">RSS</a>
          </li>
          <li class="ml-auto">
            <label for="theme-select">Theme: </label>
            <select name="theme" id="theme-select">
              <option value="auto">Auto</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </li>
        </ul>
      </nav>
      <p class="mt-4">&copy; {new Date().getFullYear()} Jacob Roling</p>
    </footer>

    <Search />

    <script>
      import htmx from "htmx.org";
      window.htmx = htmx;

      htmx.defineExtension("route-announcer", {
        onEvent: (name, _) => {
          if (name === "htmx:afterSwap") {
            if (!document.getElementById("htmx-route-announcer")) {
              //  && new URL(event.detail.requestConfig.headers["HX-Current-URL"]).pathname !== event.detail.pathInfo.finalRequestPath
              let div = document.createElement("div");
              div.setAttribute("id", "htmx-route-announcer");
              div.setAttribute("aria-live", "assertive");
              div.setAttribute("aria-atomic", "true");
              div.setAttribute(
                "style",
                "position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px"
              );
              document.body.append(div);
              setTimeout(
                () => {
                  let title =
                    document.title ||
                    document.querySelector("h1")?.textContent ||
                    location.pathname;
                  div.textContent = title;
                },
                // Much thought went into this magic number; the gist is that screen readers
                // need to see that the element changed and might not do so if it happens
                // too quickly.
                60
              );
            }
          }
        },
      });
    </script>
  </body>
</html>
